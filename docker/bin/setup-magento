#!/usr/bin/env bash

# Initializes the Magento project.

cd "$( dirname "${BASH_SOURCE[0]}" )"
cd ..

source bin/deps/utils.sh

if [ ! -d "$MAGENTO_ROOT" ]; then
    mkdir $MAGENTO_ROOT
fi

if [ -f "$MAGENTO_ROOT/composer.json" ]; then
    echo "${RED}The project directory already contains a composer.json file.${RESET}"
    exit 1
fi

./bin/cli bash -c "composer create-project --no-interaction --no-install --repository=https://packagist.galaxy.intranet/mirror/magento_official magento/project-community-edition=2.4.3-p1 .; \
    composer config --unset repositories.0; \
    composer config repositories.magento_mirror composer https://packagist.galaxy.intranet/mirror/magento_official; \
    composer config repositories.smile_libraries composer https://packagist.galaxy.intranet/libraries/; \
    composer config repositories.smile_magento2 composer https://packagist.galaxy.intranet/magento2/; \
    composer config allow-plugins.magento/* true; \
    composer config allow-plugins.laminas/* true; \
    composer config allow-plugins.cweagans/composer-patches true; \
    composer config allow-plugins.dealerdirect/phpcodesniffer-composer-installer true; \
    composer install"
